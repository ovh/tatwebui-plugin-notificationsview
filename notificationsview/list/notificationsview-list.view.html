<div class="wrapper message-notificationsview-manager">

  <div movable-dialog title="'Filter'" ng-model="ctrl.filterPosition">
    <div class="filter-dialog">
      <form>
        <div class="input-group">
          <span class="input-group-addon" id="filter-fulltext"><i class="fa fa-font"></i></span>
          <input type="text" class="form-control" placeholder="text" ng-model="ctrl.tmpFilter.filterText" aria-describedby="filter-fulltext">
        </div>
        <div class="form-group">
          <input type="text" class="form-control" placeholder="open,doing" ng-model="ctrl.tmpFilter.filterInLabel" aria-describedby="filter-labels">
          <span id="helpBlock" class="help-block">
            in <i class="fa fa-tags"></i> : Contains one or many labels of this list
          </span>
        </div>

        <div class="form-group">
          <input type="text" class="form-control" placeholder="open,doing" ng-model="ctrl.tmpFilter.filterAndLabel" aria-describedby="filter-labels">
          <span id="helpBlock" class="help-block">
            all <i class="fa fa-tags"></i> : Contains all labels in this list
          </span>
        </div>

        <div class="form-group">
          <input type="text" class="form-control" placeholder="done" ng-model="ctrl.tmpFilter.filterNotLabel" aria-describedby="filter-hide-labels">
          <span id="helpBlock" class="help-block">
            hide <i class="fa fa-tags"></i> : Hide all labels in this list
          </span>
        </div>

        <div class="form-group">
          <input type="text" class="form-control" placeholder="PCC,STOCKAGE" ng-model="ctrl.tmpFilter.filterInTag" aria-describedby="filter-tags">
          <span id="helpBlock" class="help-block">
            in <i class="glyphicon glyphicon-copyright-mark"></i> : Contains one or many tags of this list
          </span>
        </div>

        <div class="form-group">
          <input type="text" class="form-control" placeholder="PCC,STOCKAGE" ng-model="ctrl.tmpFilter.filterAndTag" aria-describedby="filter-tags">
          <span id="helpBlock" class="help-block">
            all <i class="glyphicon glyphicon-copyright-mark"></i> : Contains all tags in this list
          </span>
        </div>

        <div class="form-group">
          <input type="text" class="form-control" placeholder="PCC,STOCKAGE" ng-model="ctrl.tmpFilter.filterNotTag" aria-describedby="filter-hide-tags">
          <span id="helpBlock" class="help-block">
            hide <i class="glyphicon glyphicon-copyright-mark"></i> : Hide all tags in this list
          </span>
        </div>
        <div class="form-group">
          <button type="submit" class="btn btn-primary btn-xs" ng-click="ctrl.filterSearch()">Search</button>
        </div>
      </form>
    </div>
  </div>

  <div class="message-notificationsview-create">
      <div class="row notificationsview-footer">
					<form class="message-form" method="post" action="/">
						<div style="display: flex">
							<div class="filter" data-ng-click="ctrl.filterPosition.visible = true">
								<i class="fa fa-filter"></i>
							</div>
						</div>
						<div data-ng-if="ctrl.currentMessage.length > 0" class="users-typing"><i>{{ 'message_characters_left' | translate }}: {{ctrl.data.topic.maxlength - ctrl.currentMessage.length}}</i></div>

						<div class="formatting-tips" aria-hidden="true" dir="auto"></div>
					</form>
          <span class="message-filters">
            <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.text"><i class="fa fa-font"></i> {{ctrl.filter.text}}
                <a role="button" ng-click="ctrl.tmpFilter.filterText = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
            </span>
            <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.label">in <i class="fa fa-tags"></i> : {{ctrl.filter.label}}
                <a role="button" ng-click="ctrl.tmpFilter.filterInLabel = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
            </span>
            <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.andLabel">all <i class="fa fa-tags"></i> : {{ctrl.filter.andLabel}}
                <a role="button" ng-click="ctrl.tmpFilter.filterAndLabel = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
            </span>
            <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.notLabel">hide <i class="fa fa-tags"></i> : {{ctrl.filter.notLabel}}
                <a role="button" ng-click="ctrl.tmpFilter.filterNotLabel = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
            </span>
            <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.tag">in <i class="glyphicon glyphicon-copyright-mark"></i> {{ctrl.filter.tag}}
                <a role="button" ng-click="ctrl.tmpFilter.filterInTag = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
            </span>
            <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.andTag">all <i class="glyphicon glyphicon-copyright-mark"></i> : {{ctrl.filter.andTag}}
                <a role="button" ng-click="ctrl.tmpFilter.filterAndTag = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
            </span>
            <span class="badge" data-ng-click="ctrl.filterPosition.visible = true" data-ng-if="ctrl.filter.notTag">hide <i class="glyphicon glyphicon-copyright-mark"></i> : {{ctrl.filter.notTag}}
                <a role="button" ng-click="ctrl.tmpFilter.filterNoTag = ''; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
            </span>
            <span class="badge" data-ng-if="ctrl.filter.idMessage"> <i class="fa fa-envelope" title="message"></i> {{ctrl.filter.idMessage}}
                <a role="button" ng-click="ctrl.tmpFilter.idMessage = '-1'; ctrl.filterSearch()"><i class="fa fa-times"></i></a>
            </span>
          </span>
			</div>
  </div>
  <div class="row">
    <div class="message-notificationsview-list col-md-12">
      <table class="table table-striped">
        <tbody>
        <tr ng-repeat="msg in ctrl.data.messages" ng-class="msg.displayed ? '': ''" class="message-notificationsview-wrapper" ng-show="!msg.hide">
          <td>
            <user-display username="msg.author.username" fullname="msg.author.fullname"></user-display>
            <div class="message-notificationsview-date" title="creation: {{msg.dateCreation * 1000| amCalendar}}, update: {{msg.dateUpdate * 1000| amCalendar}}">
              {{msg.dateCreation * 1000| amDateFormat:'DD/MM, HH:mm:ss'}}
            </div>
          </td>
          <td class="message-notificationsview-wrapper">
            <span ng-bind-html="ctrl.getTextWithoutMsgId(msg) | linky | nl2br | parseTags:msg.tags"></span>
          </td>
          <td>
            <div>
                <button class="btn btn-primary" data-ng-click="ctrl.seeMsg(msg)">
                    <i class="fa fa-eye" title="{{ 'message_see' | translate }}"></i>
                </button>
                <button class="btn btn-success" data-ng-click="ctrl.addLabelRead(msg)">
                    <i class="fa fa-check" title="{{ 'message_mark_as_read' | translate }}"></i>
                </button>
                <button class="btn btn-default" data-ng-click="ctrl.addLabelUnread(msg)">
                    <i class="fa fa-eye-slash" title="{{ 'message_mark_as_unread' | translate }}"></i>
                </button>
                <button class="btn btn-default" data-ng-click="msg.deleting=true">
                    <i class="fa fa-trash" title="{{ 'message_delete' | translate }}"></i>
                </button>
            </div>
            <div data-ng-show="msg.deleting">
                <button class="btn btn-danger" data-ng-click="ctrl.deleteMessage(msg);">
                    <i class="fa fa-trash"></i>
                    {{ 'message_confirm_delete' | translate }}
                </button>
                <button class="btn btn-default" data-ng-click="msg.deleting=false">
                    <i class="fa fa-ban"></i>
                    {{ 'message_cancel' | translate }}
                </button>
            </div>
          </td>
          <td>
            <span data-ng-repeat="label in msg.labels track by $index"
                class="badge tlabel"
                style="background-color: {{label.color}}; color: {{ctrl.getBrightness(label.color)>128 ? '#000000' : '#ffffff' }}">
              <i class="fa fa-tags"></i> {{label.text}}
            </span>
          </td>
        </tr>
      </tbody>
      </table>
    </div>
  </div>

  <div class="row">
    <button data-ng-disabled="!ctrl.data.displayMore" data-ng-click="ctrl.loadMore()" class="btn btn-default">
      <span data-ng-show="!ctrl.data.displayMore">No</span> More
    </button>
  </div>
</div>
